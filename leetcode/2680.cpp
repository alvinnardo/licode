#include "../template/head.h"
#include <bits/stdc++.h>

long long maximumOr(vector<int> nums, int k) {
    // 思路：统计
    // 时间 O(nlogC)，空间 O(logC)

    // 考虑到如果最高位相同，乘以 2 以后再或，不一定最大值最优
    // 则对每个数进行模拟，或就用数组统计
    long long maxv = LLONG_MIN;
    long long val = 0;
    vector<int> vec(32);

    // 统计每一位
    auto bitAdd = [&](int num, bool add = true) {
        int pos = 0;
        while (num) {
            if (num & 1) {
                if (add) {
                    vec[pos]++;
                } else {
                    vec[pos]--;
                }
            }
            num >>= 1;
            pos++;
        }
    };

    // 将数组生成数字
    auto genNum = [&]() {
        int res = 0;
        for (int i = 0; i < vec.size(); i++) {
            if (vec[i]) {
                res += (1 << i);
            }
        }
        return res;
    };

    for (int num : nums) {
        bitAdd(num);
    }

    if (k == 0) {
        return genNum();
    }

    // 依次遍历，找到最优的那个数字
    for (int num : nums) {
        long long t = num;
        t <<= 1;
        bitAdd(num, false);
        long long gn = genNum();
        t |= gn;
        if (t > maxv) {
            maxv = t;
            val = num;
        } else if (t == maxv && num > val) { // 数字大的更好
            val = num;
        }

        bitAdd(num);
    }

    bitAdd(val, false);

    // 找到最优，那么这个数字在乘以 2 后，肯定是最大的，所以后面都是它
    return (long long)genNum() | (val << k);
}

int main(int argc, char *argv[]) {
    // 30
    cout << maximumOr({12, 9}, 1) << endl;
    // 35
    cout << maximumOr({8, 1, 2}, 2) << endl;
    // 49759
    cout << maximumOr({87, 97, 17, 20, 5, 11}, 9) << endl;
    // 1024349700095
    cout << maximumOr({299521540, 859361507, 382865762, 758520255, 101376453,
                       65915349,  563557156, 349397475, 541493247, 476254366,
                       213043257, 505224876, 463381625, 138120002, 297564443,
                       429849212, 159284608, 949993115, 203266181, 623768522,
                       374531529, 261069398, 568261042, 173704682, 632031522,
                       906479140, 86577281,  972325424, 186486153, 80847607,
                       597036495, 486007693, 792725465, 979902256, 97044299,
                       894101918, 45817604,  513117806, 96015744,  587310851,
                       989372171, 309059001, 92535726,  305270147, 447179002,
                       242616520, 735119358, 606463610, 45125986,  790901890,
                       82748483,  419657514, 51971287,  651009525, 445878547,
                       536519160, 557488664, 532455827, 508844583, 743974816,
                       465819785, 105881077, 82498860,  111061601, 938299685,
                       32059511,  5163518,   984117288, 545177316, 101179262,
                       423944490, 387065839, 410238262, 368996567, 692335985,
                       857417263, 611613086, 279971695, 316397224, 656739071,
                       70873584,  399145707, 928912936, 975361223, 50155231,
                       374791482, 511880382, 460160246, 759763660, 873241317,
                       56651413,  78099796,  831638745, 139150273, 189161397,
                       769938429, 171209783, 194324914, 606572069, 716387098,
                       148020527, 883032910, 103452936, 558258788, 104545829,
                       648305273, 268192403, 716158914, 928276967, 584589626,
                       225414337, 999150550, 983735332, 6843624,   827028124,
                       886406914, 381635106, 191424858, 346567159, 141398765,
                       64666174,  403218572, 72014913,  896304918, 394885196,
                       261176309, 518759699, 566094978, 455501222, 977848119,
                       134998427, 603521749, 860881028, 90967715,  14296888,
                       965426856, 739272987, 135005642, 534102122, 520066305,
                       719595268, 612032810, 371733206, 555846951, 618876433,
                       198761330, 294770217, 511538,    390186187, 641337375,
                       994426655, 307368712, 897072298, 66441567,  56189981,
                       291957493, 180134227, 574949679, 710568822, 635635448,
                       405314149, 845567249, 91673548,  118711529, 789051315,
                       105970436, 84138384,  380840653, 93492429,  470756857,
                       900906957, 813087696, 82789666,  272640162, 221450999,
                       554182451, 323917843, 516221215, 407210340, 714104029,
                       10074941,  254153346, 21472740,  907147239, 173111264,
                       77662721,  51621083,  353245490, 505128751, 762189905,
                       988880938, 910442900, 460273505, 933070837, 29154428,
                       101841171, 891557624, 965809163, 482681823, 985050053,
                       289082372, 383588779, 650654100, 224388389, 508745292,
                       872105098, 778570839, 832663135, 240842664, 38297531,
                       399283515, 103433957, 292450876, 273272607, 10581195,
                       465562140, 203451679, 914718629, 818807629, 708580429,
                       529424885, 660204918, 471539680, 989698389, 593275755,
                       353210459, 91539559,  337349730, 171535974, 426737733,
                       322399782, 313134697, 810326511, 973053882, 537523085,
                       171588155, 697675331, 168610276, 4251289,   791034347,
                       206907806, 403534803, 894468303, 499358681, 676807409,
                       757565849, 964920820, 880259087, 672284477, 636244801,
                       441355868, 54225714,  296449718, 765411899, 43924102,
                       742241824, 118622358, 987980013, 79591554,  142674683,
                       267234097, 254507687, 455809379, 77560608,  80077920,
                       845848815, 101665114, 777753251, 14459090,  105916402,
                       421303949, 73883247,  361967556, 315772251, 425758280,
                       38774965,  73338099,  243195451, 771550403, 598138927,
                       879440251, 65422622,  652364640, 28406321,  830834521,
                       548805094, 770648144, 801973230, 389301458, 850239697,
                       797164264, 656535554, 104747384, 105489994, 586612513,
                       37341655,  951338808, 688277626, 815094905, 818314250,
                       646710379, 88915205,  892197496, 8677935,   404687455,
                       170472127, 899969251, 330541905, 413667578, 524036005,
                       781197184, 293107828, 589458627, 286078175, 321514148,
                       272809499, 834883268, 92162292,  927299080, 76701077,
                       794918340, 724463343, 585752983, 752182075, 829953336,
                       24881847,  789523730, 633808495, 713159473, 457134986,
                       452122744, 212386203, 546050191, 196836592, 221064137,
                       803253997, 367308718, 121033387, 133795902, 780976295,
                       497585744, 767509437, 926600475, 87044370,  53587611,
                       100630974, 212370220, 740987231, 45309617,  139669299,
                       817688307, 840227957, 716648993, 255957641, 444926383,
                       399118680, 280839488, 86966464,  32927174,  993998960,
                       396617802, 337566270, 58901514,  942667992, 386919213,
                       279965651, 598438340, 754227930, 253515389, 584750593,
                       387720577, 751101132, 352260029, 166837403, 690661853,
                       258363992, 267468376, 755548424, 999351222, 312777993,
                       747734074, 669555880, 5522301,   316899418, 925513521,
                       450448683, 716018097, 206353008, 389931499, 601461623,
                       52868319,  786549300, 791544244, 111769832, 581733643,
                       178463456, 244251834, 180171982, 785207737, 497767223,
                       764922575, 25444665,  101384706, 969698955, 192282067,
                       644562911, 228062946, 459750443, 400111334, 79930519,
                       772528435, 361760,    749486399, 778050735, 317261177,
                       674999919, 81015769,  33279274,  733869278, 470947267,
                       487257248, 786737596, 257496566, 131317843, 751023779,
                       839230208, 309781298, 995275613, 871918542, 94989034,
                       345559187, 489357468, 120433699, 446943892, 459056422,
                       165232117, 91506802,  539635720, 624982559, 344134488,
                       619566238, 397510993, 344496247, 369052636, 28078079,
                       661757423, 896568906, 109093848, 547553048, 630438183,
                       580041114, 887326647, 269692130, 837537680, 18644489,
                       20715909,  529284239, 180942138, 868507873, 253719132,
                       128447524, 214067059, 743076599, 101397574, 513527302,
                       54649373,  266629690, 457550456, 594285092, 891612249,
                       801684943, 213851329, 141639593, 998697541, 435420317,
                       169717672, 512971315, 331989222, 278811519, 60524363,
                       814943757, 858852632, 800367361, 84635886,  548906663,
                       819011850, 957868146, 78190902,  999953987, 678892370,
                       184426385, 128401510, 892959428, 927502984, 82315435,
                       259003082, 982152356, 348945125, 716553537, 576437447,
                       240557373, 370754831, 642805127, 382196965, 369452371,
                       78225443,  551914636, 882423685, 262731017, 830726154,
                       795464399, 77674773,  542095138, 448348112, 14827010,
                       91001800,  119876313, 825211508, 21709053,  119830299,
                       504103877, 206135438, 100748161, 249579657, 133638421,
                       35579947,  508582738, 968307128, 384525071, 77652626,
                       397260926, 625082443, 448407456, 40066052,  859795760,
                       817859826, 118291495, 264226747, 552799862, 233538863,
                       94952901,  200780613, 311213635, 489564390, 649128724,
                       178556996, 580566189, 769005036, 3768503,   454791594,
                       741351686, 360388732, 660927031, 694616198, 609968388,
                       647081803, 730196145, 971067477, 467905282, 114721215,
                       48720102,  865166207, 592320010, 497127557, 905232258,
                       304632121, 167503734, 876040104, 568858867, 572819947,
                       109578966, 516328119, 773600559, 273308952, 5892508,
                       275245634, 451865948, 438975049, 896767021, 308150802,
                       893766642, 490635059, 668539533, 407210024, 37767608,
                       131024272, 54291826,  767963752, 102091748, 374713459,
                       735201319, 3328201,   239879665, 180037680, 500455757,
                       997628274, 484669800, 520475842, 726184730, 53528666,
                       93295789,  688280047, 422373137, 719412699, 961588999,
                       428265644, 994658333, 265971298, 867240692, 743941705,
                       574122099, 613523685, 234576763, 95177984,  20733708,
                       272344371, 226202255, 927541885, 892824474, 328294003,
                       302255343, 480542144, 331622203, 394651359, 660579823,
                       684594312, 392279633, 997765974, 205070153, 118464362,
                       903810992, 150882293, 659260760, 326184128, 870294992,
                       473366110, 606966123, 717469676, 739337407, 326723167,
                       461411380, 165975858, 940246851, 548504495, 261153841,
                       960980559, 820848865, 487356095, 741038795, 566189690,
                       668166449, 43294138,  46731834,  999788652, 290461848,
                       559828008, 536899315, 682741480, 557593982, 741969467,
                       653722193, 313921325, 892851760, 165499305, 640105452,
                       615663103, 638865414, 99587926,  333132778, 230719173,
                       426311092, 647060509, 396695030, 366557943, 195565003,
                       510365222, 180054853, 868930219, 997721316, 921093647,
                       435119909, 518404117, 816904136, 334368094, 370709120,
                       107365984, 894196101, 907608434, 642623815, 304306434,
                       502094252, 148862360, 618227758, 247462363, 314361664,
                       110849561, 863125465, 953227077, 210437487, 48774594,
                       36462601,  636748578, 695835103, 433157630, 3306520,
                       891400105, 943522851, 35877724,  612846676, 793760519,
                       809487723, 47966584,  164680987, 478908210, 234851029,
                       535390106, 438790545, 129047129, 442998539, 81414360},
                      10)
         << endl;

    return 0;
}
